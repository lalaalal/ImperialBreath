@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
    ViewData["UserId"] = Model.UserId + " - Logout";
}

<div id="home-wrapper">
    <div id="tasks" class="container">
        @{ int index = 0; }
        @foreach (var subject in Model.Subjects)
        {
            List<Models.Task> taskGroup = Model.Tasks.ToList().FindAll(task => task.SubjectId == subject.SubjectId && task.Deadline >= DateTime.Today);
            @if (taskGroup.Count == 0)
                continue;
                <div class="container p-0">
                    <div class="alert alert-info mb-2 subject-name">@subject.Name</div>
                    @foreach (var task in taskGroup)
                    {
                        string headerClass = "card-header";
                        if (task.Deadline <= DateTime.Today.AddDays(1))
                            headerClass += " urgent";
                        <div class="card">
                            <div class="@headerClass">
                                <div class="card-title m-0">@task.Summary</div>
                                <div class="custom-control custom-checkbox">
                                    <input id="task-@task.TaskId" class="custom-control-input" type="checkbox" name="name" value="" onclick="toggleTaskDone(@(index++), @task.TaskId)" @(Model.GetDoneTaskId().Contains(task.TaskId) ? "checked" : "") />
                                    <label class="custom-control-label" for="task-@task.TaskId"></label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="card-text">@task.Content</div>
                                <div class="card-text">@(task.Deadline.Month)월 @(task.Deadline.Day)일까지</div>
                            </div>
                        </div>
                    }
                </div>
        }
        @if (index == 0)
        {
            <div class="alert alert-info mb-2 subject-name">None</div>
        }

    </div>

    <div id="notice" class="card">
        <div class="card-header">
            <div class="card-title m-0">@DateTime.Today.DayOfWeek </div>
        </div>
        <div class="card-body">
            @{
                List<Models.Task> noticeTaskGroup = Model.Tasks.ToList().FindAll(task => task.WrittenDate == DateTime.Today);
                @foreach (var task in noticeTaskGroup)
                {
                    <div class="card-text">@task.Summary</div>
                }
            }
        </div>
    </div>

</div>